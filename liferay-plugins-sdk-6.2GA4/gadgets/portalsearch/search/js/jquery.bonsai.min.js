!function(a){a.fn.bonsai=function(c){var d=arguments;return this.each(function(){var e=a(this).data("bonsai");if(e||(e=new b(this,c),a(this).data("bonsai",e)),"string"==typeof c){var f=c;e[f].apply(e,[].slice.call(d,1))}})},a.bonsai={},a.bonsai.defaults={expandAll:!1,expand:null,collapse:null,checkboxes:!1,createCheckboxes:!1,handleDuplicateCheckboxes:!1,selectAllExclude:null};var b=function(b,c){var d=this;c=c||{},this.options=a.extend({},a.bonsai.defaults,c),this.el=a(b).addClass("bonsai").data("bonsai",this),this.update(),this.isRootNode()&&(this.options.handleDuplicateCheckboxes&&this.handleDuplicates(),this.options.checkboxes&&this.el.qubit(this.options),this.options.addExpandAll&&this.addExpandAllLink(),this.options.addSelectAll&&this.addSelectAllLink(),this.el.on("click",".thumb",function(b){d.toggle(a(b.currentTarget).closest("li"))})),this.options.expandAll&&this.expandAll()};b.prototype={isRootNode:function(){return this.options.scope==this.el},toggle:function(b){a(b).hasClass("expanded")?this.collapse(b):this.expand(b)},expand:function(a){this.setExpanded(a,!0)},collapse:function(a){this.setExpanded(a,!1)},setExpanded:function(b,c){if(b=a(b),b.length>1){var d=this;return void b.each(function(){d.setExpanded(this,c)})}if(c){if(!b.data("subList"))return;b=a(b).addClass("expanded").removeClass("collapsed"),a(b.data("subList")).css("height","auto")}else b=a(b).addClass("collapsed").removeClass("expanded"),a(b.data("subList")).height(0)},expandAll:function(){this.expand(this.el.find("li"))},collapseAll:function(){this.collapse(this.el.find("li"))},update:function(){var b=this;this.options.scope||(this.options.scope=this.el),this.el.children().each(function(){var c=a(this);if(b.options.createCheckboxes&&b.insertCheckbox(c),0==c.children().filter(".thumb").length){var d=a('<div class="thumb"></div>');c.prepend(d)}var e=c.children().filter("ol, ul");c.toggleClass("has-children",e.find("li").length>0),e.each(function(){if(0!=a("li",this).length){c.data("subList",this),c.hasClass("expanded")?b.expand(c):b.collapse(c);var d=!!a(this).data("bonsai");a(this).bonsai(d?"update":b.options)}})}),this.expand=this.options.expand||this.expand,this.collapse=this.options.collapse||this.collapse},insertCheckbox:function(b){if(!b.find("> input[type=checkbox]").length){var c=this.generateId(b),d=a('<input type="checkbox" name="'+this.getCheckboxName(b)+'" id="'+c+'" /> '),e=b.children(),f=b.contents().filter(function(){return 3==this.nodeType}).first();d.val(b.data("value")),d.prop("checked",b.data("checked")),e.remove(),b.append(d).append(a('<label for="'+c+'">').append(f?f:e.first())).append(f?e:e.slice(1))}},handleDuplicates:function(){var b=this;b.el.on("change","input[type=checkbox]",function(c){var d=a(c.target);if(d.val()){var e='input[type=checkbox][value="'+d.val()+'"][name="'+d.attr("name")+'"]'+(d.prop("checked")?":not(:checked)":":checked");b.el.find(e).prop({checked:d.prop("checked"),indeterminate:d.prop("indeterminate")}).trigger("change")}})},idPrefix:"checkbox-",generateId:function(c){do var d=this.idPrefix+b.uniqueId++;while(a("#"+d).length>0);return d},getCheckboxName:function(a){return a.data("name")||a.parents().filter("[data-name]").data("name")},addExpandAllLink:function(){var b=this;a('<div class="expand-all">').append(a('<a class="all">Expand all</a>').on("click",function(){b.expandAll()})).append('<i class="separator"></i>').append(a('<a class="none">Collapse all</a>').on("click",function(){b.collapseAll()})).insertBefore(this.el)},addSelectAllLink:function(){function d(){return b.find("li").filter(c.options.selectAllExclude||function(){return"none"!=a(this).css("display")}).find("> input[type=checkbox]")}var b=this.options.scope,c=this;a('<div class="check-all">').append(a('<a class="all">Select all</a>').css("cursor","pointer").on("click",function(){d().prop({checked:!0,indeterminate:!1})})).append('<i class="separator"></i>').append(a('<a class="none">Select none</a>').css("cursor","pointer").on("click",function(){d().prop({checked:!1,indeterminate:!1})})).insertAfter(this.el)},setCheckedValues:function(b){var c=this.options.scope.find("input[type=checkbox]");a.each(b,function(a,b){c.filter('[value="'+b+'"]').prop("checked",!0).trigger("change")})}},a.extend(b,{uniqueId:0})}(jQuery);